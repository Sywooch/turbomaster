$(document).ready(function(){function t(t,e){for(var a=768,n=0,i=e.length;i>n;n++){var r=$(t+" td:nth-child("+e[n]+"), "+t+" th:nth-child("+e[n]+")");$(window).width()<a?r.hide():r.show()}}function e(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function a(){$('<div id="blackScreenOverlay"></div>').addClass("blackscreen").prependTo("html")}$("#paneBox").unoslider({outControls:!0,outControlsBox:"#controls-wrap",pause:1e4}),$("#paneBlockquote").unoslider({pause:12e3}),$("#photo-rotator").unoslider({mode:"shift",createNavigation:!0}),$(".stylerize").styler(),$("#select-cascade-brand").change(function(t){$.get("/brand/modellist",{id:this.value},function(t){var e=$("#select-cascade-model");e[0].options.length=0,t.length>0&&(e.append($("<option/>").attr("value","").text("Выберите модель автомобиля")),$.each(t,function(t,a){e.append($("<option/>").attr("value",a.id).html(a.name))}),e.trigger("refresh"))})}),$("#input-partnumber").autocomplete({source:function(t,e){var a;$.ajax({url:"/search/index",data:{brand_id:$("#select-cascade-brand").val(),model_id:$("#select-cascade-model").val(),partnumber:$("#input-partnumber").val()},success:function(t){e($.map(t,function(t){return a=t.name,t.partnumber&&(a+=", "+t.partnumber),{label:a,product_id:t.id,category_id:t.category_id,brand_alias:t.brand_alias,model_alias:t.model_alias,partnumber:t.partnumber}}))}})},select:function(t,e){switch(yaCounter27743625.reachGoal("TARGET_SEARCH"),e.item.category_id){case"4":url="/tuning/"+e.item.product_id;break;case"5":url="/sparepart/"+e.item.product_id;break;case"6":url="/sparepart/"+e.item.product_id;break;default:url="/goods/"+e.item.brand_alias+"/"+e.item.model_alias+"/"+e.item.partnumber}window.location=url},minLength:3}),t("#table-popular",[1,3,6]),t("#table-products",[2,5]),$(window).resize(function(){t("#table-popular",[1,3,6]),t("#table-products",[2,5])});var n=$(".models-list a").length;n>7?$(".columns").columnize({columns:3}):n>3&&$(".columns").columnize({columns:2}),$("a.fancyble, a.zoom, .gallery-items a").fancybox({openEffect:"none",closeEffect:"none",nextEffect:"fade",prevEffect:"fade",helpers:{overlay:{locked:!1}}}),$("#question-phone-mask, #order-phone-mask").mask("+7(999) 999-99-99");var i=function(t){var e=$(t);e.appendTo("body").show().center(),a()};$("input,textarea").focus(function(){$(this).data("placeholder",$(this).attr("placeholder")),$(this).attr("placeholder","")}),$("input,textarea").blur(function(){$(this).attr("placeholder",$(this).data("placeholder"))}),$("#search-form-submit").on("click",function(t){yaCounter27743625.reachGoal("TARGET_SEARCH"),$("#search-form").submit()}),$(document).on("click",".onicon_chat-s3-btn",function(){yaCounter27743625.reachGoal("TARGET_CHAT")}),$("#question_submit").on("click",function(t){t.preventDefault();var e=!1,a=$(this),n=a.parents("form");if(n.find("input:not([type=submit]),textarea").each(function(){0==$(this).val()&&(e=!0)}),e)alert("Заполните все поля");else{a.prop("disabled",!0);var i=$("#question-popup-wrap .popup-inner"),r=i.children("h3");$.ajax({url:"/question/create",type:"post",data:n.serialize(),success:function(t){"success"==t.state&&(n.css("visibility","hidden"),$("#question-popup-wrap ul.phones").hide(),r.text("Вопрос отправлен"),$("<h4/>").css("marginn","0").text("В ближайшее время оператор  магазина ответит на ваш вопрос.").insertAfter(r),yaCounter27743625.reachGoal("TARGET_QUESTION"))}})}}),$("table").on("click",".quantity_block a",function(t){t.preventDefault();var a=$(this).parents("tr").data("lineId"),n="increase"==$(this).attr("class")?"plus":"minus",i=$("#input-quantity-"+a),r=parseInt(i.val());("minus"!=n||1!=r)&&$.ajax({url:"/cart/quantity",type:"post",data:{line_id:a,sign:n},success:function(t){i.val(t.quantity),$("#cart-total-price").text(e(t.totalPrice)+" руб.")}})}),$("body").on("click","a.cart-remove-line",function(t){t.preventDefault();{var a=$(this).parents("tr"),n=a.data("lineId");$(".cart-list-table tbody tr").length}$.ajax({url:"/cart/delete_row",type:"post",data:{line_id:n},success:function(t){$("#cart-total-price").text(e(t.totalPrice)+" руб."),a.remove(),0==$(".cart-list-table tbody tr").length&&($("#order-popup-wrap").fadeOut(),$("#blackScreenOverlay").remove())}})}),$("a.cart-add-product-link, #order.a").click(function(t){t.preventDefault();var a=$(this).data("productId");return $.ajax({url:"/cart/create",type:"post",data:{product_id:a,"X-CSRF-Token":$("meta[name=csrf-token]").prop("content")},success:function(t){if(t.lines.length>0){var a,n,r,o,c,s,p=$("#cart-list tbody");p.children("tr").remove(),$.each(t.lines,function(t,i){s=i.price>0?e(i.price):"цена по запросу",c=i.name,i.partnumber&&(c+="\n"+i.partnumber),a=$("<tr/>").attr({"data-line-id":i.line_id}),$("<td/>").text(c).appendTo(a),n=$("<td/>"),r=$("<input/>").attr({type:"text",readonly:"readonly",id:"input-quantity-"+i.line_id}).val(i.quantity).addClass("quantity_value").appendTo(n),o=$("<div/>").addClass("quantity_block"),$("<a/>").addClass("increase").text("+").appendTo(o),$("<a/>").addClass("decrease").text("-").appendTo(o),o.appendTo(n),n.appendTo(a),$("<td/>").text(s).addClass("center").appendTo(a),$("<td/>").addClass("center").append($('<a href="#" class="cart-remove-line"><i class="fa fa-times"></i></a>')).appendTo(a),a.appendTo(p)}),$("#cart-total-price").text(e(t.totalPrice)+" руб."),i("#order-popup-wrap")}}}),!1}),$("#form-order-submit").click(function(t){t.preventDefault();var e=!1,a=$(this),n=a.parents("form");n.find("input:not([type=submit]),textarea").each(function(){0==$(this).val()&&(e=!0)}),e?alert("Заполните все поля"):(yaCounter27743625.reachGoal("TARGET_ORDER"),a.prop("disabled",!0),n.submit())}),$("a.question-add-link").click(function(t){t.preventDefault();var e=$(this).data("questionType"),a=$("#question-popup-wrap h3"),n=$("#question-form-type"),r=$("#question-form-product_id");r.val($(this).data("productId")),"common_question"==e?(a.text("Задать вопрос о товаре"),n.val(1)):"price_request"==e&&(a.text("Запросить цену"),n.val(2)),i("#question-popup-wrap")}),$("a#popup-diagn").click(function(t){t.preventDefault(),i($("#diagnostics_table"))}),$(".popup-close").click(function(){$(this).parents("div.popup-wrap").hide(),$("#blackScreenOverlay").remove()}),$("#show-opinion-form").click(function(t){t.preventDefault(),$("#opinion-popup-wrap").show(),i("#opinion-popup-wrap")}),$("#opinion_submit").on("click",function(t){t.preventDefault();var e=!1,a=$(this),n=a.parents("form");if(n.find('input[type=text]:not("#input-company"), textarea').each(function(){0==$(this).val()&&(e=!0)}),e)alert("Заполните все поля");else{a.prop("disabled",!0);var i=$("#opinion-popup-wrap .popup-inner"),r=i.children("h3");$.ajax({url:"/opinion/create",type:"post",data:n.serialize(),success:function(t){"success"==t.state&&(n.css("visibility","hidden"),r.text("Спасибо за отзыв!"),$("<p/>").css("margin","80px 0 -80px 0").text("Сразу после модерации ваш отзыв будет опубликован на этой странице.").insertAfter(r))}})}}),jQuery.fn.center=function(){this.css("position","absolute"),this.css("top",Math.max(0,($(window).height()-$(this).outerHeight())/4+$(window).scrollTop())+"px");var t=$(window).width();768>t&&this.width(t-30);var e=t>768?(t-$(this).outerWidth())/2+$(window).scrollLeft()-70:10;return this.css("left",e+"px"),this}});